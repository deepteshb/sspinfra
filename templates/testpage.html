{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col login-sec">
      <h2 class="">Launch Product</h2>
      <p class="card p-3" style="background-color: rgb(243, 243, 243);">Select your customer and you will be able
        to see the associated Products and Components for the customer. Then you can add additional details to
        create your launch configuration.
        Once you have decided on the launch configuration submit your request. Your request will be queued and
        once the infrastructure is provisioned you will recieve an email with details.
      </p>
      <a class="btn btn-sg" href="{{url_for('userservicelist')}}"><i class="fa fa-step-backward"
          aria-hidden="true"></i>&nbsp;Go Back</a>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th><input type="checkbox" id=selectall></th>
          <th>Customer</th>
          <th>Product</th>
          <th>Version</th>
          <th>Component</th>
          <th># Instances</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            {{form.csrf_token(class="form")}}
          </td>
          <td>{{form.customer(class="customer")}}
          </td>
          <td>
            {{form.product(class="product")}}
          </td>
          <td>
            {{form.version(class="version")}}
          </td>
          <td>
            {{form.component(class="component")}}
          </td>
          <td>
            {{form.instance(class="instance")}}
          </td>
          <td>
            <button id="add-row" class="btn btn-sg"><i class="fa fa-plus" aria-hidden="true"></i></button>
            <button id="remove-row" class="btn btn-sg"><i class="fa fa-trash" aria-hidden="true"></i></button>
          </td>
        </tr>

      </tbody>
    </table>
  </div>

  <div>
    <button id="submit" class="btn btn-sg" onclick='submit()'>Submit Request <i class="fa fa-arrow-right"
        aria-hidden="true"></i></button>
    <button id="submit" class="btn btn-danger" onclick='cancel()'>Cancel <i class="fa fa-trash"
        aria-hidden="true"></i></button>
  </div>
</div>
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $('.customer').change(function () {
    customer = $('.customer').val() 
    //console.log(customer)
    fetch('/getproducts/' + customer).then(function (response) {
      //console.log(response)
      response.json().then(function (data) {
        //console.log(data)
        for (product of data.products) {
          //console.log(product.product)
          //console.log(product.id)
          $('.product').find('option').text(product.product)
          $('.product').find('option').val(product.id)
        }
      });
    });
  });

  $('.product').focus(function () {
    product = $('.product').val()
    //console.log(product)
    //console.log(version)
    fetch('/getversions/' + product).then(function (response) {
      //console.log(response)
      response.json().then(function (data) {
        //console.log(data)
        $('.version').empty()
        for (version of data.versions) {
          console.log($('.version').val())
          //console.log(version.id)
          //console.log(version.version)
          $('.version').append('<option value ="'+ version.id +'">'+ version.version +'</option>')
          console.log($('.version').val())
        }
      });
    });
  });

  $('.version').focus(function () {
    version = $('.version').val()
    console.log(version)
    //console.log(product)
    //console.log(version)
    fetch('/getcomponents/' + version).then(function (response) {
      //console.log(response)
      response.json().then(function (data) {
        //console.log(data)
        $('.component').empty()
        for (component of data.components) {
          console.log($('.component').val())
          //console.log(version.id)
          //console.log(version.version)
          $('.component').append('<option value ="'+ component.id +'">'+ component.compname +'</option>')
          console.log($('.component').val())
        }
      });
    });
  });

  $("#add-row").click(
    console.log('hi')
    )
</script>
{% endblock %}